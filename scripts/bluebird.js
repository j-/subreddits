/**
 * @preserve The MIT License (MIT)
 *
 * Copyright (c) 2014 Petka Antonov
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:</p>
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 */

/**
 * The MIT License (MIT)
 * 
 * Copyright (c) 2014 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:</p>
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */

!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.Promise=e():"undefined"!=typeof global?global.Promise=e():"undefined"!=typeof self&&(self.Promise=e())}(function(){var define,module,exports;return function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){t.exports=function(e){function n(e){var n=new t(e),r=n.promise();return r.isRejected()?r:(n.setHowMany(1),n.setUnwrap(),n.init(),r)}var t=e._SomePromiseArray;e.any=function(t){return n(t)},e.prototype.any=function(){return n(this)}}},{}],2:[function(e,t,n){function a(){this._isTickUsed=!1,this._schedule=r,this._length=0,this._lateBuffer=new i(16),this._functionBuffer=new i(65536);var e=this;this.consumeFunctionBuffer=function(){e._consumeFunctionBuffer()}}var r=e("./schedule.js"),i=e("./queue.js"),s=e("./util.js").errorObj,o=e("./util.js").tryCatch1,u=typeof process!="undefined"?process:void 0;a.prototype.haveItemsQueued=function(){return this._length>0},a.prototype.invokeLater=function(t,n,r){u!==void 0&&u.domain!=null&&!t.domain&&(t=u.domain.bind(t)),this._lateBuffer.push(t,n,r),this._queueTick()},a.prototype.invoke=function(t,n,r){u!==void 0&&u.domain!=null&&!t.domain&&(t=u.domain.bind(t));var i=this._functionBuffer;i.push(t,n,r),this._length=i.length(),this._queueTick()},a.prototype._consumeFunctionBuffer=function(){var t=this._functionBuffer;while(t.length()>0){var n=t.shift(),r=t.shift(),i=t.shift();n.call(r,i)}this._reset(),this._consumeLateBuffer()},a.prototype._consumeLateBuffer=function(){var t=this._lateBuffer;while(t.length()>0){var n=t.shift(),r=t.shift(),i=t.shift(),u=o(n,r,i);if(u===s){this._queueTick();if(n.domain==null)throw u.e;n.domain.emit("error",u.e)}}},a.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},a.prototype._reset=function(){this._isTickUsed=!1,this._length=0},t.exports=new a},{"./queue.js":25,"./schedule.js":28,"./util.js":35}],3:[function(e,t,n){var r=e("./promise.js")();t.exports=r},{"./promise.js":20}],4:[function(e,t,n){var r=Object.create;if(r){var i=r(null),s=r(null);i[" size"]=s[" size"]=0}t.exports=function(t){function u(e){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,e))}function a(e){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))}function f(e,t,n){var r=n[e];if(typeof r!="function"){if(!o(e))return null;r=t(e),n[e]=r,n[" size"]++;if(n[" size"]>512){var i=Object.keys(n);for(var s=0;s<256;++s)delete n[i[s]];n[" size"]=i.length-256}}return r}function l(e){return f(e,u,i)}function c(e){return f(e,a,s)}function h(e){return e[this.pop()].apply(e,this)}function p(e){return e[this]}function d(e){return e[this]}var n=e("./util.js"),r=n.canEvaluate,o=n.isIdentifier;t.prototype.call=function(t){var n=arguments.length,i=new Array(n-1);for(var s=1;s<n;++s)i[s-1]=arguments[s];if(r){var o=l(t);if(o!==null)return this._then(o,void 0,void 0,i,void 0)}return i.push(t),this._then(h,void 0,void 0,i,void 0)},t.prototype.get=function(t){var n=typeof t=="number",i;if(!n)if(r){var s=c(t);i=s!==null?s:p}else i=p;else i=d;return this._then(i,void 0,void 0,t,void 0)}}},{"./util.js":35}],5:[function(e,t,n){t.exports=function(t,n){var r=e("./errors.js"),i=r.canAttach,s=e("./async.js"),o=r.CancellationError;t.prototype._cancel=function(t){if(!this.isCancellable())return this;var n,r=this;while((n=r._cancellationParent)!==void 0&&n.isCancellable())r=n;this._unsetCancellable(),r._attachExtraTrace(t),r._rejectUnchecked(t)},t.prototype.cancel=function(t){return this.isCancellable()?(t=t!==void 0?i(t)?t:new Error(t+""):new o,s.invokeLater(this._cancel,this,t),this):this},t.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},t.prototype.uncancellable=function(){var r=new t(n);return r._propagateFrom(this,6),r._follow(this),r._unsetCancellable(),r},t.prototype.fork=function(t,n,r){var i=this._then(t,n,r,void 0,void 0);return i._setCancellable(),i._cancellationParent=void 0,i}}},{"./async.js":2,"./errors.js":10}],6:[function(e,t,n){t.exports=function(){function o(e){var t;if(typeof e=="function")t="[function "+(e.name||"anonymous")+"]";else{t=e.toString();var n=/\[object [a-zA-Z0-9$_]+\]/;if(n.test(t))try{var r=JSON.stringify(e);t=r}catch(i){}t.length===0&&(t="(empty array)")}return"(<"+u(t)+">, no stack trace)"}function u(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}function a(e,t){this.captureStackTrace(a,t)}var t=e("./util.js").inherits,n=e("./es5.js").defineProperty,r=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|3|4|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),i=null,s=null;t(a,Error),a.prototype.captureStackTrace=function(t,n){f(this,t,n)},a.possiblyUnhandledRejection=function(t){if(typeof console=="object"){var n;if(typeof t=="object"||typeof t=="function"){var r=t.stack;n="Possibly unhandled "+s(r,t)}else n="Possibly unhandled "+String(t);typeof console.error=="function"||typeof console.error=="object"?console.error(n):(typeof console.log=="function"||typeof console.log=="object")&&console.log(n)}},a.combine=function(t,n){var s=t.length-1,o=t[s],u=-1;for(var a=n.length-1;a>=0;--a)if(n[a]===o){u=a;break}for(var a=u;a>=0;--a){var f=n[a];if(t[s]!==f)break;t.pop(),s--}t.push("From previous event:");var l=t.concat(n),c=[];for(var a=0,h=l.length;a<h;++a){if(r.test(l[a])&&i.test(l[a])||a>0&&!i.test(l[a])&&l[a]!=="From previous event:")continue;c.push(l[a])}return c},a.protectErrorMessageNewlines=function(e){for(var t=0;t<e.length;++t)if(i.test(e[t]))break;if(t<=1)return;var n=[];for(var r=0;r<t;++r)n.push(e.shift());e.unshift(n.join("\0"))},a.isSupported=function(){return typeof f=="function"};var f=function l(){if(typeof Error.stackTraceLimit=="number"&&typeof Error.captureStackTrace=="function"){i=/^\s*at\s*/,s=function(e,t){return typeof e=="string"?e:t.name!==void 0&&t.message!==void 0?t.name+". "+t.message:o(t)};var e=Error.captureStackTrace;return function(n,r){e(n,r)}}var t=new Error;if(typeof t.stack=="string"&&typeof "".startsWith=="function"&&t.stack.startsWith("stackDetection@")&&l.name==="stackDetection"){n(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),i=/@/;var r=/[@\n]/;return s=function(e,t){return typeof e=="string"?t.name+". "+t.message+"\n"+e:t.name!==void 0&&t.message!==void 0?t.name+". "+t.message:o(t)},function(t){var n=(new Error).stack,i=n.split(r),s=i.length,o="";for(var u=0;u<s;u+=2)o+=i[u],o+="@",o+=i[u+1],o+="\n";t.stack=o}}return s=function(e,t){return typeof e=="string"?e:typeof t!="object"&&typeof t!="function"||t.name===void 0||t.message===void 0?o(t):t.name+". "+t.message},null}();return a}},{"./es5.js":12,"./util.js":35}],7:[function(e,t,n){t.exports=function(t){function a(e,t,n){this._instances=e,this._callback=t,this._promise=n}function f(e,t){var n={},r=i(e,n,t);if(r===s)return r;var a=o(n);return a.length?(s.e=new u("Catch filter must inherit from Error or be a simple predicate function"),s):r}var n=e("./util.js"),r=e("./errors.js"),i=n.tryCatch1,s=n.errorObj,o=e("./es5.js").keys,u=r.TypeError;return a.prototype.doFilter=function(n){var o=this._callback,u=this._promise,a=u._boundTo;for(var l=0,c=this._instances.length;l<c;++l){var h=this._instances[l],p=h===Error||h!=null&&h.prototype instanceof Error;if(p&&n instanceof h){var d=i(o,a,n);return d===s?(t.e=d.e,t):d}if(typeof h=="function"&&!p){var v=f(h,n);if(v===s){var m=r.canAttach(s.e)?s.e:new Error(s.e+"");this._promise._attachExtraTrace(m),n=s.e;break}if(v){var d=i(o,a,n);return d===s?(t.e=d.e,t):d}}}return t.e=n,t},a}},{"./errors.js":10,"./es5.js":12,"./util.js":35}],8:[function(e,t,n){var r=e("./util.js"),i=r.isPrimitive,s=r.wrapsPrimitiveReceiver;t.exports=function(e){var t=function(){return this},n=function(){throw this},r=function(t,n){if(n===1)return function(){throw t};if(n===2)return function(){return t}};e.prototype["return"]=e.prototype.thenReturn=function(n){return s&&i(n)?this._then(r(n,2),void 0,void 0,void 0,void 0):this._then(t,void 0,void 0,n,void 0)},e.prototype["throw"]=e.prototype.thenThrow=function(t){return s&&i(t)?this._then(r(t,1),void 0,void 0,void 0,void 0):this._then(n,void 0,void 0,t,void 0)}}},{"./util.js":35}],9:[function(e,t,n){t.exports=function(e,t){var n=e.reduce;e.prototype.each=function(r){return n(this,r,null,t)},e.each=function(r,i){return n(r,i,null,t)}}},{}],10:[function(e,t,n){function u(e){try{o(e,"isOperational",!0)}catch(t){}}function a(e){return e==null?!1:e instanceof E||e.isOperational===!0}function f(e){return e instanceof Error}function l(e){return f(e)}function c(e,t){function n(r){if(!(this instanceof n))return new n(r);this.message=typeof r=="string"?r:t,this.name=e,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}return s(n,Error),n}function E(e){this.name="OperationalError",this.message=e,this.cause=e,this.isOperational=!0,e instanceof Error?(this.message=e.message,this.stack=e.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var r=e("./es5.js").freeze,i=e("./util.js"),s=i.inherits,o=i.notEnumerableProp,h,p,d=c("CancellationError","cancellation error"),v=c("TimeoutError","timeout error"),m=c("AggregateError","aggregate error");try{h=TypeError,p=RangeError}catch(g){h=c("TypeError","type error"),p=c("RangeError","range error")}var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" ");for(var b=0;b<y.length;++b)typeof Array.prototype[y[b]]=="function"&&(m.prototype[y[b]]=Array.prototype[y[b]]);m.prototype.length=0,m.prototype.isOperational=!0;var w=0;m.prototype.toString=function(){var e=Array(w*4+1).join(" "),t="\n"+e+"AggregateError of:"+"\n";w++,e=Array(w*4+1).join(" ");for(var n=0;n<this.length;++n){var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n");for(var s=0;s<i.length;++s)i[s]=e+i[s];r=i.join("\n"),t+=r+"\n"}return w--,t},s(E,Error);var S="__BluebirdErrorTypes__",x=Error[S];x||(x=r({CancellationError:d,TimeoutError:v,OperationalError:E,RejectionError:E,AggregateError:m}),o(Error,S,x)),t.exports={Error:Error,TypeError:h,RangeError:p,CancellationError:x.CancellationError,OperationalError:x.OperationalError,TimeoutError:x.TimeoutError,AggregateError:x.AggregateError,originatesFromRejection:a,markAsOriginatingFromRejection:u,canAttach:l}},{"./es5.js":12,"./util.js":35}],11:[function(e,t,n){t.exports=function(t){function r(e){var r=new n(e),i=t.rejected(r),s=i._peekContext();return s!=null&&s._attachExtraTrace(r),i}var n=e("./errors.js").TypeError;return r}},{"./errors.js":10}],12:[function(e,t,n){var r=function(){"use strict";return this===void 0}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r};else{var i={}.hasOwnProperty,s={}.toString,o={}.constructor.prototype,u=function(t){var n=[];for(var r in t)i.call(t,r)&&n.push(r);return n},a=function(t,n,r){return t[n]=r.value,t},f=function(t){return t},l=function(t){try{return Object(t).constructor.prototype}catch(n){return o}},c=function(t){try{return s.call(t)==="[object Array]"}catch(n){return!1}};t.exports={isArray:c,keys:u,defineProperty:a,freeze:f,getPrototypeOf:l,isES5:r}}},{}],13:[function(e,t,n){t.exports=function(e,t){var n=e.map;e.prototype.filter=function(r,i){return n(this,r,i,t)},e.filter=function(r,i,s){return n(r,i,s,t)}}},{}],14:[function(e,t,n){t.exports=function(t,n,r){function a(){return this}function f(){throw this}function l(e){return function(){return e}}function c(e){return function(){throw e}}function h(e,t,n){var r;return s&&o(t)?r=n?l(t):c(t):r=n?a:f,e._then(r,u,void 0,t,void 0)}function p(e){var i=this.promise,s=this.handler,o=i._isBound()?s.call(i._boundTo):s();if(o!==void 0){var u=r(o,void 0);if(u instanceof t)return h(u,e,i.isFulfilled())}return i.isRejected()?(n.e=e,n):e}function d(e){var n=this.promise,i=this.handler,s=n._isBound()?i.call(n._boundTo,e):i(e);if(s!==void 0){var o=r(s,void 0);if(o instanceof t)return h(o,e,!0)}return e}var i=e("./util.js"),s=i.wrapsPrimitiveReceiver,o=i.isPrimitive,u=i.thrower;t.prototype._passThroughHandler=function(t,n){if(typeof t!="function")return this.then();var r={promise:this,handler:t};return this._then(n?p:d,n?p:void 0,void 0,r,void 0)},t.prototype.lastly=t.prototype["finally"]=function(t){return this._passThroughHandler(t,!0)},t.prototype.tap=function(t){return this._passThroughHandler(t,!1)}}},{"./util.js":35}],15:[function(e,t,n){t.exports=function(t,n,r,i){function h(e,n){var r=f,s=t,o=n.length;for(var u=0;u<o;++u){var a=l(n[u],void 0,e);if(a===r)return s.reject(r.e);var c=i(a,h);if(c instanceof s)return c}return null}function p(e,n,i){var s=this._promise=new t(r);s._setTrace(void 0),this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers=typeof i=="function"?[i].concat(c):c}var s=e("./errors.js"),o=s.TypeError,u=e("./util.js").deprecated,a=e("./util.js"),f=a.errorObj,l=a.tryCatch1,c=[];p.prototype.promise=function(){return this._promise},p.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},p.prototype._continue=function(n){if(n===f){this._generator=void 0;var r=s.canAttach(n.e)?n.e:new Error(n.e+"");this._promise._attachExtraTrace(r),this._promise._reject(n.e,r);return}var u=n.value;if(n.done===!0)this._generator=void 0,this._promise._tryFollow(u)||this._promise._fulfill(u);else{var a=i(u,void 0);if(!(a instanceof t)){a=h(a,this._yieldHandlers);if(a===null){this._throw(new o("A value was yielded that could not be treated as a promise"));return}}a._then(this._next,this._throw,void 0,this,null)}},p.prototype._throw=function(t){s.canAttach(t)&&this._promise._attachExtraTrace(t),this._continue(l(this._generator["throw"],this._generator,t))},p.prototype._next=function(t){this._continue(l(this._generator.next,this._generator,t))},t.coroutine=function(t,n){if(typeof t!="function")throw new o("generatorFunction must be a function");var r=Object(n).yieldHandler,i=p;return function(){var e=t.apply(this,arguments),n=new i(void 0,void 0,r);return n._generator=e,n._next(void 0),n.promise()}},t.coroutine.addYieldHandler=function(e){if(typeof e!="function")throw new o("fn must be a function");c.push(e)},t.spawn=function(r){u("Promise.spawn is deprecated. Use Promise.coroutine instead.");if(typeof r!="function")return n("generatorFunction must be a function");var i=new p(r,this),s=i.promise();return i._run(t.spawn),s}}},{"./errors.js":10,"./util.js":35}],16:[function(e,t,n){t.exports=function(t,n,r,i){function v(e){this._reject(e)}var s=e("./util.js"),o=s.canEvaluate,u=s.tryCatch1,a=s.errorObj;if(o){var f=function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))},l=function(e){var t=[];for(var n=1;n<=e;++n)t.push("holder.p"+n);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,t.join(", ")))},c=[],h=[void 0];for(var p=1;p<=5;++p)c.push(f(p)),h.push(l(p));var d=function(e,t){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=t,this.total=e,this.now=0};d.prototype.callers=h,d.prototype.checkFulfillment=function(e){var t=this.now;t++;var n=this.total;if(t>=n){var r=this.callers[n],i=u(r,void 0,this);i===a?e._rejectUnchecked(i.e):e._tryFollow(i)||e._fulfillUnchecked(i)}else this.now=t}}t.join=function(){var s=arguments.length-1,u;if(s>0&&typeof arguments[s]=="function"){u=arguments[s];if(s<6&&o){var a=new t(i);a._setTrace(void 0);var f=new d(s,u),l=c;for(var h=0;h<s;++h){var p=r(arguments[h],void 0);p instanceof t?p.isPending()?p._then(l[h],v,void 0,a,f):p.isFulfilled()?l[h].call(a,p._settledValue,f):(a._reject(p._settledValue),p._unsetRejectionIsUnhandled()):l[h].call(a,p,f)}return a}}var m=arguments.length,g=new Array(m);for(var y=0;y<m;++y)g[y]=arguments[y];var a=(new n(g)).promise();return u!==void 0?a.spread(u):a}}},{"./util.js":35}],17:[function(e,t,n){t.exports=function(t,n,r,i,s){function c(e,t,n,r){this.constructor$(e),this._callback=t,this._preservedValues=r===s?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:l,this._init$(void 0,-2)}function h(e,t,n,r){var i=typeof n=="object"&&n!==null?n.concurrency:0;return i=typeof i=="number"&&isFinite(i)&&i>=1?i:0,new c(e,t,i,r)}var o=e("./util.js"),u=o.tryCatch3,a=o.errorObj,f={},l=[];o.inherits(c,n),c.prototype._init=function(){},c.prototype._promiseFulfilled=function(n,r){var s=this._values;if(s===null)return;var o=this.length(),l=this._preservedValues,c=this._limit;if(s[r]===f){s[r]=n;if(c>=1){this._inFlight--,this._drainQueue();if(this._isResolved())return}}else{if(c>=1&&this._inFlight>=c){s[r]=n,this._queue.push(r);return}l!==null&&(l[r]=n);var h=this._callback,p=this._promise._boundTo,d=u(h,p,n,r,o);if(d===a)return this._reject(d.e);var v=i(d,void 0);if(v instanceof t){if(v.isPending())return c>=1&&this._inFlight++,s[r]=f,v._proxyPromiseArray(this,r);if(!v.isFulfilled())return v._unsetRejectionIsUnhandled(),this._reject(v.reason());d=v.value()}s[r]=d}var m=++this._totalResolved;m>=o&&(l!==null?this._filter(s,l):this._resolve(s))},c.prototype._drainQueue=function(){var t=this._queue,n=this._limit,r=this._values;while(t.length>0&&this._inFlight<n){var i=t.pop();this._promiseFulfilled(r[i],i)}},c.prototype._filter=function(t,n){var r=n.length,i=new Array(r),s=0;for(var o=0;o<r;++o)t[o]&&(i[s++]=n[o]);i.length=s,this._resolve(i)},c.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(t,n){return typeof t!="function"?r("fn must be a function"):h(this,t,n,null).promise()},t.map=function(t,n,i,s){return typeof n!="function"?r("fn must be a function"):h(t,n,i,s).promise()}}},{"./util.js":35}],18:[function(e,t,n){t.exports=function(t){function u(e){throw e}function a(e,t){if(!n.isArray(e))return f(e,t);var i=n.tryCatchApply(this,[null].concat(e),t);i===o&&r.invokeLater(u,void 0,i.e)}function f(e,t){var n=this,a=e===void 0?s(n,t,null):i(n,t,null,e);a===o&&r.invokeLater(u,void 0,a.e)}function l(e,t){var n=this,i=s(n,t,e);i===o&&r.invokeLater(u,void 0,i.e)}var n=e("./util.js"),r=e("./async.js"),i=n.tryCatch2,s=n.tryCatch1,o=n.errorObj;t.prototype.nodeify=function(t,n){if(typeof t=="function"){var r=f;n!==void 0&&Object(n).spread&&(r=a),this._then(r,l,void 0,t,this._boundTo)}return this}}},{"./async.js":2,"./util.js":35}],19:[function(e,t,n){t.exports=function(t,n){var r=e("./util.js"),i=e("./async.js"),s=e("./errors.js"),o=r.tryCatch1,u=r.errorObj;t.prototype.progressed=function(t){return this._then(void 0,void 0,t,void 0,void 0)},t.prototype._progress=function(t){if(this._isFollowingOrFulfilledOrRejected())return;this._progressUnchecked(t)},t.prototype._clearFirstHandlerData$Base=t.prototype._clearFirstHandlerData,t.prototype._clearFirstHandlerData=function(){this._clearFirstHandlerData$Base(),this._progressHandler0=void 0},t.prototype._progressHandlerAt=function(t){return t===0?this._progressHandler0:this[(t<<2)+t-5+2]},t.prototype._doProgressWith=function(n){var r=n.value,i=n.handler,a=n.promise,f=n.receiver,l=o(i,f,r);if(l===u){if(l.e!=null&&l.e.name!=="StopProgressPropagation"){var c=s.canAttach(l.e)?l.e:new Error(l.e+"");a._attachExtraTrace(c),a._progress(l.e)}}else l instanceof t?l._then(a._progress,null,null,a,void 0):a._progress(l)},t.prototype._progressUnchecked=function(r){if(!this.isPending())return;var s=this._length(),o=this._progress;for(var u=0;u<s;u++){var a=this._progressHandlerAt(u),f=this._promiseAt(u);if(!(f instanceof t)){var l=this._receiverAt(u);typeof a=="function"?a.call(l,r,f):l instanceof t&&l._isProxied()?l._progressUnchecked(r):l instanceof n&&l._promiseProgressed(r,f);continue}typeof a=="function"?i.invoke(this._doProgressWith,this,{handler:a,promise:f,receiver:this._receiverAt(u),value:r}):i.invoke(o,f,r)}}}},{"./async.js":2,"./errors.js":10,"./util.js":35}],20:[function(e,t,n){function i(e){try{Promise===e&&(Promise=r)}catch(t){}return e}var r;typeof Promise!="undefined"&&(r=Promise),t.exports=function(){function A(e){if(typeof e!="function")throw new b("the promise constructor requires a resolver function");if(this.constructor!==A)throw new b("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,e!==s&&this._resolveFromResolver(e)}function O(e){return e[0]}function M(){return new A.PromiseInspection(this)}var t=e("./util.js"),n=e("./async.js"),r=e("./errors.js"),s=function(){},o={},u={e:null},a=e("./thenables.js")(A,s),f=e("./promise_array.js")(A,s,a),l=e("./captured_trace.js")(),c=e("./catch_filter.js")(u),h=e("./promise_resolver.js"),p=t.isArray,d=t.errorObj,v=t.tryCatch1,m=t.tryCatch2,g=t.tryCatchApply,y=r.RangeError,b=r.TypeError,w=r.CancellationError,E=r.TimeoutError,S=r.OperationalError,x=r.originatesFromRejection,T=r.markAsOriginatingFromRejection,N=r.canAttach,C=t.thrower,k=e("./errors_api_rejection")(A),L=function(){return new b("circular promise resolution chain")};A.prototype.bind=function(t){var n=a(t,void 0),r=new A(s);if(n instanceof A){var i=n.then(function(e){r._setBoundTo(e)}),o=A.all([this,i]).then(O);r._follow(o)}else r._follow(this),r._setBoundTo(t);return r._propagateFrom(this,3),r},A.prototype.toString=function(){return"[object Promise]"},A.prototype.caught=A.prototype["catch"]=function(t){var n=arguments.length;if(n>1){var r=new Array(n-1),i=0,s;for(s=0;s<n-1;++s){var o=arguments[s];if(typeof o!="function"){var u=new b("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(u),A.reject(u)}r[i++]=o}r.length=i,t=arguments[s],this._resetTrace();var a=new c(r,t,this);return this._then(void 0,a.doFilter,void 0,a,void 0)}return this._then(void 0,t,void 0,void 0,void 0)},A.prototype.reflect=function(){return this._then(M,M,void 0,this,void 0)},A.prototype.then=function(t,n,r){return this._then(t,n,r,void 0,void 0)},A.prototype.done=function(t,n,r){var i=this._then(t,n,r,void 0,void 0);i._setIsFinal()},A.prototype.spread=function(t,n){return this._then(t,n,void 0,o,void 0)},A.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},A.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this._settledValue,t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this._settledValue,t.isRejected=!0),t},A.prototype.all=function(){return(new f(this)).promise()},A.is=function(t){return t instanceof A},A.all=function(t){return(new f(t)).promise()},A.prototype.error=function(t){return this.caught(x,t)},A.prototype._resolveFromSyncValue=function(t){if(t===d){this._cleanValues(),this._setRejected();var n=t.e;this._settledValue=n,this._tryAttachExtraTrace(n),this._ensurePossibleRejectionHandled()}else{var r=a(t,void 0);r instanceof A?this._follow(r):(this._cleanValues(),this._setFulfilled(),this._settledValue=t)}},A.method=function(t){if(typeof t!="function")throw new b("fn must be a function");return function(){var n;switch(arguments.length){case 0:n=v(t,this,void 0);break;case 1:n=v(t,this,arguments[0]);break;case 2:n=m(t,this,arguments[0],arguments[1]);break;default:var r=arguments.length,i=new Array(r);for(var o=0;o<r;++o)i[o]=arguments[o];n=g(t,i,this)}var u=new A(s);return u._setTrace(void 0),u._resolveFromSyncValue(n),u}},A.attempt=A["try"]=function(t,n,r){if(typeof t!="function")return k("fn must be a function");var i=p(n)?g(t,n,r):v(t,r,n),o=new A(s);return o._setTrace(void 0),o._resolveFromSyncValue(i),o},A.defer=A.pending=function(){var t=new A(s);return t._setTrace(void 0),new h(t)},A.bind=function(t){var n=a(t,void 0),r=new A(s);r._setTrace(void 0);if(n instanceof A){var i=n.then(function(e){r._setBoundTo(e)});r._follow(i)}else r._setBoundTo(t),r._setFulfilled();return r},A.cast=function(t){var n=a(t,void 0);if(!(n instanceof A)){var r=n;n=new A(s),n._setTrace(void 0),n._setFulfilled(),n._cleanValues(),n._settledValue=r}return n},A.resolve=A.fulfilled=A.cast,A.reject=A.rejected=function(t){var n=new A(s);n._setTrace(void 0),T(t),n._cleanValues(),n._setRejected(),n._settledValue=t;if(!N(t)){var r=new Error(t+"");n._setCarriedStackTrace(r)}return n._ensurePossibleRejectionHandled(),n},A.onPossiblyUnhandledRejection=function(t){l.possiblyUnhandledRejection=typeof t=="function"?t:void 0};var _;A.onUnhandledRejectionHandled=function(t){_=typeof t=="function"?t:void 0};var D=!(typeof process=="undefined"||typeof process.execPath!="string"||typeof process.env!="object"||!process.env.BLUEBIRD_DEBUG&&process.env.NODE_ENV!=="development");A.longStackTraces=function(){if(n.haveItemsQueued()&&D===!1)throw new Error("cannot enable long stack traces after promises have been created");D=l.isSupported()},A.hasLongStackTraces=function(){return D&&l.isSupported()},A.prototype._then=function(t,r,i,o,u){var a=u!==void 0,f=a?u:new A(s);if(!a){if(D){var l=this._peekContext()===this._traceParent;f._traceParent=l?this._traceParent:this}f._propagateFrom(this,7)}var c=this._addCallbacks(t,r,i,f,o);return this.isResolved()&&n.invoke(this._queueSettleAt,this,c),f},A.prototype._length=function(){return this._bitField&262143},A.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0},A.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912},A.prototype._setLength=function(t){this._bitField=this._bitField&-262144|t&262143},A.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456},A.prototype._setRejected=function(){this._bitField=this._bitField|134217728},A.prototype._setFollowing=function(){this._bitField=this._bitField|536870912},A.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432},A.prototype._isFinal=function(){return(this._bitField&33554432)>0},A.prototype._cancellable=function(){return(this._bitField&67108864)>0},A.prototype._setCancellable=function(){this._bitField=this._bitField|67108864},A.prototype._unsetCancellable=function(){this._bitField=this._bitField&-67108865},A.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152},A.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-2097153,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},A.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0},A.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288},A.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-524289},A.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0},A.prototype._setCarriedStackTrace=function(t){this._bitField=this._bitField|1048576,this._fulfillmentHandler0=t},A.prototype._unsetCarriedStackTrace=function(){this._bitField=this._bitField&-1048577,this._fulfillmentHandler0=void 0},A.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0},A.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},A.prototype._receiverAt=function(t){var n=t===0?this._receiver0:this[(t<<2)+t-5+4];return this._isBound()&&n===void 0?this._boundTo:n},A.prototype._promiseAt=function(t){return t===0?this._promise0:this[(t<<2)+t-5+3]},A.prototype._fulfillmentHandlerAt=function(t){return t===0?this._fulfillmentHandler0:this[(t<<2)+t-5+0]},A.prototype._rejectionHandlerAt=function(t){return t===0?this._rejectionHandler0:this[(t<<2)+t-5+1]},A.prototype._addCallbacks=function(t,n,r,i,s){var o=this._length();o>=262138&&(o=0,this._setLength(0));if(o===0)this._promise0=i,s!==void 0&&(this._receiver0=s),typeof t=="function"&&!this._isCarryingStackTrace()&&(this._fulfillmentHandler0=t),typeof n=="function"&&(this._rejectionHandler0=n),typeof r=="function"&&(this._progressHandler0=r);else{var u=(o<<2)+o-5;this[u+3]=i,this[u+4]=s,this[u+0]=typeof t=="function"?t:void 0,this[u+1]=typeof n=="function"?n:void 0,this[u+2]=typeof r=="function"?r:void 0}return this._setLength(o+1),o},A.prototype._setProxyHandlers=function(t,n){var r=this._length();r>=262138&&(r=0,this._setLength(0));if(r===0)this._promise0=n,this._receiver0=t;else{var i=(r<<2)+r-5;this[i+3]=n,this[i+4]=t,this[i+0]=this[i+1]=this[i+2]=void 0}this._setLength(r+1)},A.prototype._proxyPromiseArray=function(t,n){this._setProxyHandlers(t,n)},A.prototype._proxyPromise=function(t){t._setProxied(),this._setProxyHandlers(t,-15)},A.prototype._setBoundTo=function(t){t!==void 0?(this._bitField=this._bitField|8388608,this._boundTo=t):this._bitField=this._bitField&-8388609},A.prototype._isBound=function(){return(this._bitField&8388608)===8388608},A.prototype._resolveFromResolver=function(t){function r(e){if(n._tryFollow(e))return;n._fulfill(e)}function i(e){var t=N(e)?e:new Error(e+"");n._attachExtraTrace(t),T(e),n._reject(e,t===e?void 0:t)}var n=this;this._setTrace(void 0),this._pushContext();var s=m(t,void 0,r,i);this._popContext();if(s!==void 0&&s===d){var o=s.e,u=N(o)?o:new Error(o+"");n._reject(o,u)}},A.prototype._spreadSlowCase=function(t,n,r,i){var s=(new f(r)).promise(),u=s._then(function(){return t.apply(i,arguments)},void 0,void 0,o,void 0);n._follow(u)},A.prototype._callSpread=function(t,n,r){var i=this._boundTo;if(p(r))for(var s=0,o=r.length;s<o;++s)if(a(r[s],void 0)instanceof A){this._spreadSlowCase(t,n,r,i);return}return n._pushContext(),g(t,r,i)},A.prototype._callHandler=function(t,n,r,i){var s;return n===o&&!this.isRejected()?s=this._callSpread(t,r,i):(r._pushContext(),s=v(t,n,i)),r._popContext(),s},A.prototype._settlePromiseFromHandler=function(t,n,r,i){if(!(i instanceof A)){t.call(n,r,i);return}if(i.isResolved())return;var s=this._callHandler(t,n,i,r);if(i._isFollowing())return;if(s===d||s===i||s===u){var o=s===i?L():s.e,f=N(o)?o:new Error(o+"");s!==u&&i._attachExtraTrace(f),i._rejectUnchecked(o,f)}else{var l=a(s,i);if(l instanceof A){if(l.isRejected()&&!l._isCarryingStackTrace()&&!N(l._settledValue)){var f=new Error(l._settledValue+"");i._attachExtraTrace(f),l._setCarriedStackTrace(f)}i._follow(l),i._propagateFrom(l,1)}else i._fulfillUnchecked(s)}},A.prototype._follow=function(t){this._setFollowing(),t.isPending()?(this._propagateFrom(t,1),t._proxyPromise(this)):t.isFulfilled()?this._fulfillUnchecked(t._settledValue):this._rejectUnchecked(t._settledValue,t._getCarriedStackTrace()),t._isRejectionUnhandled()&&t._unsetRejectionIsUnhandled(),D&&t._traceParent==null&&(t._traceParent=this)},A.prototype._tryFollow=function(t){if(this._isFollowingOrFulfilledOrRejected()||t===this)return!1;var n=a(t,void 0);return n instanceof A?(this._follow(n),!0):!1},A.prototype._resetTrace=function(){D&&(this._trace=new l(this._peekContext()===void 0))},A.prototype._setTrace=function(t){if(D){var n=this._peekContext();this._traceParent=n;var r=n===void 0;t!==void 0&&t._traceParent===n?this._trace=t._trace:this._trace=new l(r)}return this},A.prototype._tryAttachExtraTrace=function(t){N(t)&&this._attachExtraTrace(t)},A.prototype._attachExtraTrace=function(t){if(D){var n=this,r=t.stack;r=typeof r=="string"?r.split("\n"):[],l.protectErrorMessageNewlines(r);var i=1,s=1;while(n!=null&&n._trace!=null)r=l.combine(r,n._trace.stack.split("\n")),n=n._traceParent,s++;var o=Error.stackTraceLimit||10,u=(o+i)*s,a=r.length;a>u&&(r.length=u),a>0&&(r[0]=r[0].split("\0").join("\n")),r.length<=i?t.stack="(No stack trace)":t.stack=r.join("\n")}},A.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},A.prototype._propagateFrom=function(t,n){(n&1)>0&&t._cancellable()&&(this._setCancellable(),this._cancellationParent=t),(n&4)>0&&this._setBoundTo(t._boundTo),(n&2)>0&&this._setTrace(t)},A.prototype._fulfill=function(t){if(this._isFollowingOrFulfilledOrRejected())return;this._fulfillUnchecked(t)},A.prototype._reject=function(t,n){if(this._isFollowingOrFulfilledOrRejected())return;this._rejectUnchecked(t,n)},A.prototype._settlePromiseAt=function(t){var n=this.isFulfilled()?this._fulfillmentHandlerAt(t):this._rejectionHandlerAt(t),r=this._settledValue,i=this._receiverAt(t),s=this._promiseAt(t);if(typeof n=="function")this._settlePromiseFromHandler(n,i,r,s);else{var o=!1,u=this.isFulfilled();i!==void 0&&(i instanceof A&&i._isProxied()?(i._unsetProxied(),u?i._fulfillUnchecked(r):i._rejectUnchecked(r,this._getCarriedStackTrace()),o=!0):i instanceof f&&(u?i._promiseFulfilled(r,s):i._promiseRejected(r,s),o=!0)),o||(u?s._fulfill(r):s._reject(r,this._getCarriedStackTrace()))}t>=4&&this._queueGC()},A.prototype._isProxied=function(){return(this._bitField&4194304)===4194304},A.prototype._setProxied=function(){this._bitField=this._bitField|4194304},A.prototype._unsetProxied=function(){this._bitField=this._bitField&-4194305},A.prototype._isGcQueued=function(){return(this._bitField&-1073741824)===-1073741824},A.prototype._setGcQueued=function(){this._bitField=this._bitField|-1073741824},A.prototype._unsetGcQueued=function(){this._bitField=this._bitField&1073741823},A.prototype._queueGC=function(){if(this._isGcQueued())return;this._setGcQueued(),n.invokeLater(this._gc,this,void 0)},A.prototype._gc=function(){var t=this._length()*5-5;for(var n=0;n<t;n++)delete this[n];this._clearFirstHandlerData(),this._setLength(0),this._unsetGcQueued()},A.prototype._clearFirstHandlerData=function(){this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0},A.prototype._queueSettleAt=function(t){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),n.invoke(this._settlePromiseAt,this,t)},A.prototype._fulfillUnchecked=function(t){if(!this.isPending())return;if(t===this){var r=L();return this._attachExtraTrace(r),this._rejectUnchecked(r,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=t;var i=this._length();i>0&&n.invoke(this._settlePromises,this,i)},A.prototype._rejectUncheckedCheckError=function(t){var n=N(t)?t:new Error(t+"");this._rejectUnchecked(t,n===t?void 0:n)},A.prototype._rejectUnchecked=function(t,r){if(!this.isPending())return;if(t===this){var i=L();return this._attachExtraTrace(i),this._rejectUnchecked(i)}this._cleanValues(),this._setRejected(),this._settledValue=t;if(this._isFinal()){n.invokeLater(C,void 0,r===void 0?t:r);return}var s=this._length();r!==void 0&&this._setCarriedStackTrace(r),s>0?n.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()},A.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},A.prototype._settlePromises=function(){var t=this._length();for(var n=0;n<t;n++)this._settlePromiseAt(n)},A.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),l.possiblyUnhandledRejection!==void 0&&n.invokeLater(this._notifyUnhandledRejection,this,void 0)},A.prototype._notifyUnhandledRejectionIsHandled=function(){typeof _=="function"&&n.invokeLater(_,void 0,this)},A.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue,n=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),n!==void 0&&(this._unsetCarriedStackTrace(),t=n),typeof l.possiblyUnhandledRejection=="function"&&l.possiblyUnhandledRejection(t,this)}};var P=[];return A.prototype._peekContext=function(){var t=P.length-1;return t>=0?P[t]:void 0},A.prototype._pushContext=function(){if(!D)return;P.push(this)},A.prototype._popContext=function(){if(!D)return;P.pop()},A.noConflict=function(){return i(A)},A.setScheduler=function(e){if(typeof e!="function")throw new b("fn must be a function");n._schedule=e},l.isSupported()||(A.longStackTraces=function(){},D=!1),A._makeSelfResolutionError=L,e("./finally.js")(A,u,a),e("./direct_resolve.js")(A),e("./synchronous_inspection.js")(A),e("./join.js")(A,f,a,s),A.RangeError=y,A.CancellationError=w,A.TimeoutError=E,A.TypeError=b,A.OperationalError=S,A.RejectionError=S,A.AggregateError=r.AggregateError,t.toFastProperties(A),t.toFastProperties(A.prototype),A.Promise=A,e("./timers.js")(A,s,a),e("./race.js")(A,s,a),e("./call_get.js")(A),e("./generators.js")(A,k,s,a),e("./map.js")(A,f,k,a,s),e("./nodeify.js")(A),e("./promisify.js")(A,s),e("./props.js")(A,f,a),e("./reduce.js")(A,f,k,a,s),e("./settle.js")(A,f),e("./some.js")(A,f,k),e("./progress.js")(A,f),e("./cancel.js")(A,s),e("./filter.js")(A,s),e("./any.js")(A,f),e("./each.js")(A,s),e("./using.js")(A,k,a),A.prototype=A.prototype,A}},{"./any.js":1,"./async.js":2,"./call_get.js":4,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./direct_resolve.js":8,"./each.js":9,"./errors.js":10,"./errors_api_rejection":11,"./filter.js":13,"./finally.js":14,"./generators.js":15,"./join.js":16,"./map.js":17,"./nodeify.js":18,"./progress.js":19,"./promise_array.js":21,"./promise_resolver.js":22,"./promisify.js":23,"./props.js":24,"./race.js":26,"./reduce.js":27,"./settle.js":29,"./some.js":30,"./synchronous_inspection.js":31,"./thenables.js":32,"./timers.js":33,"./using.js":34,"./util.js":35}],21:[function(e,t,n){t.exports=function(t,n,r){function u(e){switch(e){case-1:return void 0;case-2:return[];case-3:return{}}}function a(e){var r=this._promise=new t(n),i=void 0;e instanceof t&&(i=e,r._propagateFrom(i,5)),r._setTrace(i),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var i=e("./errors.js").canAttach,s=e("./util.js"),o=s.isArray;return a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function f(e,n){var i=r(this._values,void 0);if(i instanceof t){this._values=i,i._setBoundTo(this._promise._boundTo);if(!i.isFulfilled()){if(i.isPending()){i._then(f,this._reject,void 0,this,n);return}i._unsetRejectionIsUnhandled(),this._reject(i._settledValue);return}i=i._settledValue;if(!o(i)){var s=new t.TypeError("expecting an array, a promise or a thenable");this.__hardReject__(s);return}}else if(!o(i)){var s=new t.TypeError("expecting an array, a promise or a thenable");this.__hardReject__(s);return}if(i.length===0){n===-5?this._resolveEmptyArray():this._resolve(u(n));return}var a=this.getActualLength(i.length),l=a,c=this.shouldCopyValues()?new Array(a):this._values,h=!1;for(var p=0;p<a;++p){var d=r(i[p],void 0);d instanceof t?d.isPending()?d._proxyPromiseArray(this,p):(d._unsetRejectionIsUnhandled(),h=!0):h=!0,c[p]=d}this._values=c,this._length=l,h&&this._scanDirectValues(a)},a.prototype._settlePromiseAt=function(n){var r=this._values[n];r instanceof t?r.isFulfilled()?this._promiseFulfilled(r._settledValue,n):r.isRejected()&&this._promiseRejected(r._settledValue,n):this._promiseFulfilled(r,n)},a.prototype._scanDirectValues=function(t){for(var n=0;n<t;++n){if(this._isResolved())break;this._settlePromiseAt(n)}},a.prototype._isResolved=function(){return this._values===null},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype.__hardReject__=a.prototype._reject=function(t){this._values=null;var n=i(t)?t:new Error(t+"");this._promise._attachExtraTrace(n),this._promise._reject(t,n)},a.prototype._promiseProgressed=function(t,n){if(this._isResolved())return;this._promise._progress({index:n,value:t})},a.prototype._promiseFulfilled=function(t,n){if(this._isResolved())return;this._values[n]=t;var r=++this._totalResolved;r>=this._length&&this._resolve(this._values)},a.prototype._promiseRejected=function(t,n){if(this._isResolved())return;this._totalResolved++,this._reject(t)},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},{"./errors.js":10,"./util.js":35}],22:[function(e,t,n){function c(e){return e instanceof Error&&l.getPrototypeOf(e)===Error.prototype}function h(e){var t;return c(e)?t=new u(e):t=e,s.markAsOriginatingFromRejection(t),t}function p(e){function t(t,n){if(e===null)return;if(t){var r=h(i(t));e._attachExtraTrace(r),e._reject(r)}else if(arguments.length>2){var s=arguments.length,o=new Array(s-1);for(var u=1;u<s;++u)o[u-1]=arguments[u];e._fulfill(o)}else e._fulfill(n);e=null}return t}var r=e("./util.js"),i=r.maybeWrapAsError,s=e("./errors.js"),o=s.TimeoutError,u=s.OperationalError,a=e("./async.js"),f=r.haveGetters,l=e("./es5.js"),d;f?d=function(t){this.promise=t}:d=function(t){this.promise=t,this.asCallback=p(t),this.callback=this.asCallback};if(f){var v={get:function(){return p(this.promise)}};l.defineProperty(d.prototype,"asCallback",v),l.defineProperty(d.prototype,"callback",v)}d._nodebackForPromise=p,d.prototype.toString=function(){return"[object PromiseResolver]"},d.prototype.resolve=d.prototype.fulfill=function(t){if(!(this instanceof d))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var n=this.promise;if(n._tryFollow(t))return;a.invoke(n._fulfill,n,t)},d.prototype.reject=function(t){if(!(this instanceof d))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var n=this.promise;s.markAsOriginatingFromRejection(t);var r=s.canAttach(t)?t:new Error(t+"");n._attachExtraTrace(r),a.invoke(n._reject,n,t),r!==t&&a.invoke(this._setCarriedStackTrace,this,r)},d.prototype.progress=function(t){if(!(this instanceof d))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");a.invoke(this.promise._progress,this.promise,t)},d.prototype.cancel=function(){a.invoke(this.promise.cancel,this.promise,void 0)},d.prototype.timeout=function(){this.reject(new o("timeout"))},d.prototype.isResolved=function(){return this.promise.isResolved()},d.prototype.toJSON=function(){return this.promise.toJSON()},d.prototype._setCarriedStackTrace=function(t){this.promise.isRejected()&&this.promise._setCarriedStackTrace(t)},t.exports=d},{"./async.js":2,"./errors.js":10,"./es5.js":12,"./util.js":35}],23:[function(e,t,n){t.exports=function(t,n){function p(e){return e.replace(/([$])/,"\\$")}function d(e){try{return e.__isPromisified__===!0}catch(t){return!1}}function v(e,t,n){var r=i.getDataPropertyOrDefault(e,t+n,h);return r?d(r):!1}function m(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i)){var s=i.replace(n,"");for(var o=0;o<e.length;o+=2)if(e[o]===s)throw new f("Cannot promisify an API that has normal methods with '"+t+"'-suffix")}}}function g(e,t,n,r){var s=i.inheritedDataKeys(e),o=[];for(var u=0;u<s.length;++u){var a=s[u],f=e[a];typeof f=="function"&&!d(f)&&!v(e,a,t)&&r(a,f,e)&&o.push(a,f)}return m(o,t,n),o}function y(e){var t=[e],n=Math.max(0,e-1-5);for(var r=e-1;r>=n;--r){if(r===e)continue;t.push(r)}for(var r=e+1;r<=5;++r)t.push(r);return t}function b(e){return i.filledRange(e,"arguments[","]")}function w(e){return i.filledRange(e,"_arg","")}function E(e){return typeof e.length=="number"?Math.max(Math.min(e.length,1024),0):0}function S(e){return i.isIdentifier(e)?"."+e:"['"+e.replace(/(['\\])/g,"\\$1")+"']"}function x(e,a,f,l,c){function v(t){var n=b(t).join(", "),i=t>0?", ":"",s;return typeof e=="string"?s="                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",S(e)):a===r?s="                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":a!==void 0?s="                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":s="                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",s.replace("{{args}}",n).replace(", ",i)}function m(){var t="";for(var n=0;n<p.length;++n)t+="case "+p[n]+":"+v(p[n]);var i;return typeof e=="string"?i="                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",S(e)):a===r?i="                                                  \n                callback.apply(this, args);                                  \n            ":i="                                                  \n                callback.apply(receiver, args);                              \n            ",t+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",i),t}var h=Math.max(0,E(l)-1),p=y(h),d=typeof f=="string"&&i.isIdentifier(f)?f+c:"promisified";return(new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function FunctionName(Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(void 0);                                       \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",d).replace("Parameters",w(h)).replace("[CodeForSwitchCase]",m())))(t,e,a,o,u,s,n)}function T(e,i){function a(){var a=i;i===r&&(a=this),typeof e=="string"&&(e=a[e]);var f=new t(n);f._setTrace(void 0);var l=s(f);try{e.apply(a,o(arguments,l))}catch(c){var h=u(c);f._attachExtraTrace(h),f._reject(h)}return f}return a.__isPromisified__=!0,a}function C(e,t,n,s){var o=new RegExp(p(t)+"$"),u=g(e,t,o,n);for(var a=0,f=u.length;a<f;a+=2){var l=u[a],c=u[a+1],h=l+t;e[h]=s===N?N(l,r,l,c,t):s(c)}return i.toFastProperties(e),e}function k(e,t){return N(e,t,void 0,e)}var r={},i=e("./util.js"),s=e("./promise_resolver.js")._nodebackForPromise,o=i.withAppended,u=i.maybeWrapAsError,a=i.canEvaluate,f=e("./errors").TypeError,l="Async",c=function(e,t){return i.isIdentifier(e)&&e.charAt(0)!=="_"&&!i.isClass(t)},h={__isPromisified__:!0},N=a?x:T;t.promisify=function(t,n){if(typeof t!="function")throw new f("fn must be a function");return d(t)?t:k(t,arguments.length<2?r:n)},t.promisifyAll=function(t,n){if(typeof t!="function"&&typeof t!="object")throw new f("the target of promisifyAll must be an object or a function");n=Object(n);var r=n.suffix;typeof r!="string"&&(r=l);var s=n.filter;typeof s!="function"&&(s=c);var o=n.promisifier;typeof o!="function"&&(o=N);if(!i.isIdentifier(r))throw new RangeError("suffix must be a valid identifier");var u=i.inheritedDataKeys(t,{includeHidden:!0});for(var a=0;a<u.length;++a){var h=t[u[a]];u[a]!=="constructor"&&i.isClass(h)&&(C(h.prototype,r,s,o),C(h,r,s,o))}return C(t,r,s,o)}}},{"./errors":10,"./promise_resolver.js":22,"./util.js":35}],24:[function(e,t,n){t.exports=function(t,n,r){function a(e){var t=u.keys(e),n=t.length,r=new Array(n*2);for(var i=0;i<n;++i){var s=t[i];r[i]=e[s],r[i+n]=s}this.constructor$(r)}function f(e){var n,i=r(e,void 0);return o(i)?(i instanceof t?n=i._then(t.props,void 0,void 0,void 0,void 0):n=(new a(i)).promise(),i instanceof t&&n._propagateFrom(i,4),n):s("cannot await properties of a non-object")}var i=e("./util.js"),s=e("./errors_api_rejection")(t),o=i.isObject,u=e("./es5.js");i.inherits(a,n),a.prototype._init=function(){this._init$(void 0,-3)},a.prototype._promiseFulfilled=function(t,n){if(this._isResolved())return;this._values[n]=t;var r=++this._totalResolved;if(r>=this._length){var i={},s=this.length();for(var o=0,u=this.length();o<u;++o)i[this._values[o+s]]=this._values[o];this._resolve(i)}},a.prototype._promiseProgressed=function(t,n){if(this._isResolved())return;this._promise._progress({key:this._values[n+this.length()],value:t})},a.prototype.shouldCopyValues=function(){return!1},a.prototype.getActualLength=function(t){return t>>1},t.prototype.props=function(){return f(this)},t.props=function(t){return f(t)}}},{"./errors_api_rejection":11,"./es5.js":12,"./util.js":35}],25:[function(e,t,n){function r(e,t,n,r,i){for(var s=0;s<i;++s)n[s+r]=e[s+t]}function i(e){this._capacity=e,this._length=0,this._front=0,this._makeCapacity()}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var n=this.length();this._checkCapacity(n+1);var r=this._front+n&this._capacity-1;this[r]=t,this._length=n+1},i.prototype.push=function(t,n,r){var i=this.length()+3;if(this._willBeOverCapacity(i)){this._pushOne(t),this._pushOne(n),this._pushOne(r);return}var s=this._front+i-3;this._checkCapacity(i);var o=this._capacity-1;this[s+0&o]=t,this[s+1&o]=n,this[s+2&o]=r,this._length=i},i.prototype.shift=function(){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,n},i.prototype.length=function(){return this._length},i.prototype._makeCapacity=function(){var t=this._capacity;for(var n=0;n<t;++n)this[n]=void 0},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<3)},i.prototype._resizeTo=function(t){var n=this._front,i=this._capacity,s=new Array(i),o=this.length();r(this,0,s,0,i),this._capacity=t,this._makeCapacity(),this._front=0;if(n+o<=i)r(s,n,this,0,o);else{var u=o-(n+o&i-1);r(s,n,this,0,u),r(s,0,this,u,o-u)}},t.exports=i},{}],26:[function(e,t,n){t.exports=function(t,n,r){function a(e,a){var f=r(e,void 0);if(f instanceof t)return o(f);if(!s(e))return i("expecting an array, a promise or a thenable");var l=new t(n);a!==void 0?l._propagateFrom(a,7):l._setTrace(void 0);var c=l._fulfill,h=l._reject;for(var p=0,d=e.length;p<d;++p){var v=e[p];if(v===void 0&&!u.call(e,p))continue;t.cast(v)._then(c,h,void 0,l,null)}return l}var i=e("./errors_api_rejection.js")(t),s=e("./util.js").isArray,o=function(t){return t.then(function(e){return a(e,t)})},u={}.hasOwnProperty;t.race=function(t){return a(t,void 0)},t.prototype.race=function(){return a(this,void 0)}}},{"./errors_api_rejection.js":11,"./util.js":35}],27:[function(e,t,n){t.exports=function(t,n,r,i,s){function l(e,n,r,o){this.constructor$(e),this._preservedValues=o===s?[]:null,this._zerothIsAccum=r===void 0,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=undefined;var u=i(r,void 0),a=!1,f=u instanceof t;f&&(u.isPending()?u._proxyPromiseArray(this,-1):u.isFulfilled()?(r=u.value(),this._gotAccum=!0):(u._unsetRejectionIsUnhandled(),this._reject(u.reason()),a=!0)),!f&&!this._zerothIsAccum&&(this._gotAccum=!0),this._callback=n,this._accum=r,a||this._init$(void 0,-5)}function c(e,t,n,i){if(typeof t!="function")return r("fn must be a function");var s=new l(e,t,n,i);return s.promise()}var o=e("./util.js"),u=o.tryCatch4,a=o.tryCatch3,f=o.errorObj;o.inherits(l,n),l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(this._preservedValues!==null?[]:this._accum)},l.prototype._promiseFulfilled=function(n,r){var s=this._values;if(s===null)return;var o=this.length(),l=this._preservedValues,c=l!==null,h=this._gotAccum,p=this._valuesPhase,d;if(!p){p=this._valuesPhase=Array(o);for(d=0;d<o;++d)p[d]=0}d=p[r],r===0&&this._zerothIsAccum?(h||(this._accum=n,this._gotAccum=h=!0),p[r]=d===0?1:2):r===-1?h||(this._accum=n,this._gotAccum=h=!0):d===0?p[r]=1:(p[r]=2,h&&(this._accum=n));if(!h)return;var v=this._callback,m=this._promise._boundTo,g;for(var y=this._reducingIndex;y<o;++y){d=p[y];if(d===2){this._reducingIndex=y+1;continue}if(d!==1)return;n=s[y];if(n instanceof t){if(!n.isFulfilled()){if(n.isPending())return;return n._unsetRejectionIsUnhandled(),this._reject(n.reason())}n=n._settledValue}c?(l.push(n),g=a(v,m,n,y,o)):g=u(v,m,this._accum,n,y,o);if(g===f)return this._reject(g.e);var b=i(g,void 0);if(b instanceof t){if(b.isPending())return p[y]=4,b._proxyPromiseArray(this,y);if(!b.isFulfilled())return b._unsetRejectionIsUnhandled(),this._reject(b.reason());g=b.value()}this._reducingIndex=y+1,this._accum=g}if(this._reducingIndex<o)return;this._resolve(c?l:this._accum)},t.prototype.reduce=function(t,n){return c(this,t,n,null)},t.reduce=function(t,n,r,i){return c(t,n,r,i)}}},{"./util.js":35}],28:[function(e,t,n){var r,i;if(typeof process=="object"&&typeof process.version=="string")r=function(t){process.nextTick(t)};else if(typeof MutationObserver!="undefined"&&(i=MutationObserver)||typeof WebKitMutationObserver!="undefined"&&(i=WebKitMutationObserver))r=function(){var e=document.createElement("div"),t=void 0,n=new i(function(){var n=t;t=void 0,n()});return n.observe(e,{attributes:!0}),function(r){t=r,e.classList.toggle("foo")}}();else{if(typeof setTimeout=="undefined")throw new Error("no async scheduler available");r=function(t){setTimeout(t,0)}}t.exports=r},{}],29:[function(e,t,n){t.exports=function(t,n){function s(e){this.constructor$(e)}var r=t.PromiseInspection,i=e("./util.js");i.inherits(s,n),s.prototype._promiseResolved=function(t,n){this._values[t]=n;var r=++this._totalResolved;r>=this._length&&this._resolve(this._values)},s.prototype._promiseFulfilled=function(t,n){if(this._isResolved())return;var i=new r;i._bitField=268435456,i._settledValue=t,this._promiseResolved(n,i)},s.prototype._promiseRejected=function(t,n){if(this._isResolved())return;var i=new r;i._bitField=134217728,i._settledValue=t,this._promiseResolved(n,i)},t.settle=function(t){return(new s(t)).promise()},t.prototype.settle=function(){return(new s(this)).promise()}}},{"./util.js":35}],30:[function(e,t,n){t.exports=function(t,n,r){function a(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(e,t){if((t|0)!==t||t<0)return r("expecting a positive integer");var n=new a(e),i=n.promise();return i.isRejected()?i:(n.setHowMany(t),n.init(),i)}var i=e("./util.js"),s=e("./errors.js").RangeError,o=e("./errors.js").AggregateError,u=i.isArray;i.inherits(a,n),a.prototype._init=function(){if(!this._initialized)return;if(this._howMany===0){this._resolve([]);return}this._init$(void 0,-5);var t=u(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))},a.prototype.init=function(){this._initialized=!0,this._init()},a.prototype.setUnwrap=function(){this._unwrap=!0},a.prototype.howMany=function(){return this._howMany},a.prototype.setHowMany=function(t){if(this._isResolved())return;this._howMany=t},a.prototype._promiseFulfilled=function(t){if(this._isResolved())return;this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this.howMany()===1&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},a.prototype._promiseRejected=function(t){if(this._isResolved())return;this._addRejected(t);if(this.howMany()>this._canPossiblyFulfill()){var n=new o;for(var r=this.length();r<this._values.length;++r)n.push(this._values[r]);this._reject(n)}},a.prototype._fulfilled=function(){return this._totalResolved},a.prototype._rejected=function(){return this._values.length-this.length()},a.prototype._addRejected=function(t){this._values.push(t)},a.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},a.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},a.prototype._getRangeError=function(t){var n="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new s(n)},a.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,n){return f(t,n)},t.prototype.some=function(t){return f(this,t)},t._SomePromiseArray=a}},{"./errors.js":10,"./util.js":35}],31:[function(e,t,n){t.exports=function(e){function t(e){e!==void 0?(this._bitField=e._bitField,this._settledValue=e.isResolved()?e._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}t.prototype.isFulfilled=e.prototype.isFulfilled=function(){return(this._bitField&268435456)>0},t.prototype.isRejected=e.prototype.isRejected=function(){return(this._bitField&134217728)>0},t.prototype.isPending=e.prototype.isPending=function(){return(this._bitField&402653184)===0},t.prototype.value=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},t.prototype.error=t.prototype.reason=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},t.prototype.isResolved=e.prototype.isResolved=function(){return(this._bitField&402653184)>0},e.PromiseInspection=t}},{}],32:[function(e,t,n){t.exports=function(t,n){function u(e){try{return e.then}catch(t){return s.e=t,s}}function a(e,r){if(o(e)){if(e instanceof t)return e;if(l(e)){var a=new t(n);return a._setTrace(void 0),e._then(a._fulfillUnchecked,a._rejectUncheckedCheckError,a._progressUnchecked,a,null),a._setFollowing(),a}var f=u(e);if(f===s)return r!==void 0&&i(f.e)&&r._attachExtraTrace(f.e),t.reject(f.e);if(typeof f=="function")return c(e,f,r)}return e}function l(e){return f.call(e,"_promise0")}function c(e,n,r){function f(n){if(o)return;o=!0;if(e===n){var i=t._makeSelfResolutionError();r!==void 0&&r._attachExtraTrace(i),s.promise._reject(i,void 0);return}s.resolve(n)}function l(e){if(o)return;o=!0;var t=i(e)?e:new Error(e+"");r!==void 0&&r._attachExtraTrace(t),s.promise._reject(e,t)}function c(e){if(o)return;var t=s.promise;typeof t._progress=="function"&&t._progress(e)}var s=t.defer(),o=!1;try{n.call(e,f,l,c)}catch(u){if(!o){o=!0;var a=i(u)?u:new Error(u+"");r!==void 0&&r._attachExtraTrace(a),s.promise._reject(u,a)}}return s.promise}var r=e("./util.js"),i=e("./errors.js").canAttach,s=r.errorObj,o=r.isObject,f={}.hasOwnProperty;return a}},{"./errors.js":10,"./util.js":35}],33:[function(e,t,n){var r=function(e,t){var n=arguments.length,r=arguments[2],i=arguments[3],s=n>=5?arguments[4]:void 0;return setTimeout(function(){e(r,i,s)},t|0)};t.exports=function(t,n,i){function h(e){var t=this;return t instanceof Number&&(t=+t),clearTimeout(t),e}function p(e){var t=this;throw t instanceof Number&&(t=+t),clearTimeout(t),e}var s=e("./util.js"),o=e("./errors.js"),u=e("./errors_api_rejection")(t),a=t.TimeoutError,f=function(t,n,r){if(!t.isPending())return;typeof n!="string"&&(n="operation timed out after "+r+" ms");var i=new a(n);o.markAsOriginatingFromRejection(i),t._attachExtraTrace(i),t._cancel(i)},l=function(t,n){n._fulfill(t)},c=t.delay=function(s,o){o===void 0&&(o=s,s=void 0),o=+o;var u=i(s,void 0),a=new t(n);return u instanceof t?(a._propagateFrom(u,7),a._follow(u),a.then(function(e){return t.delay(e,o)})):(a._setTrace(void 0),r(l,o,s,a),a)};t.prototype.delay=function(t){return c(this,t)},t.prototype.timeout=function(i,s){i=+i;var o=new t(n);o._propagateFrom(this,7),o._follow(this);var u=r(f,i,o,s,i);return o.cancellable()._then(h,p,void 0,u,void 0)}}},{"./errors.js":10,"./errors_api_rejection":11,"./util.js":35}],34:[function(e,t,n){t.exports=function(t,n,r){function u(e){var n=e.length;for(var r=0;r<n;++r){var i=e[r];if(i.isRejected())return t.reject(i.error());e[r]=i.value()}return e}function a(e){setTimeout(function(){throw e},0)}function f(e){var t=r(e,void 0);return t!==e&&typeof e._isDisposable=="function"&&typeof e._getDisposer=="function"&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function l(e,n){function u(){if(i>=s)return o.resolve();var l=f(e[i++]);if(l instanceof t&&l._isDisposable()){try{l=r(l._getDisposer().tryDispose(n),void 0)}catch(c){return a(c)}if(l instanceof t)return l._then(u,a,null,null,null)}u()}var i=0,s=e.length,o=t.defer();return u(),o.promise}function c(e){var t=new o;return t._settledValue=e,t._bitField=268435456,l(this,t).thenReturn(e)}function h(e){var t=new o;return t._settledValue=e,t._bitField=134217728,l(this,t).thenThrow(e)}function p(e,t){this._data=e,this._promise=t}function d(e,t){this.constructor$(e,t)}var i=e("./errors.js").TypeError,s=e("./util.js").inherits,o=t.PromiseInspection;p.prototype.data=function(){return this._data},p.prototype.promise=function(){return this._promise},p.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},p.prototype.tryDispose=function(e){var t=this.resource(),n=t!==null?this.doDispose(t,e):null;return this._promise._unsetDisposable(),this._data=this._promise=null,n},p.isDisposer=function(t){return t!=null&&typeof t.resource=="function"&&typeof t.tryDispose=="function"},s(d,p),d.prototype.doDispose=function(e,t){var n=this.data();return n.call(e,e,t)},t.using=function(){var r=arguments.length;if(r<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[r-1];if(typeof i!="function")return n("fn must be a function");r--;var s=new Array(r);for(var o=0;o<r;++o){var a=arguments[o];if(p.isDisposer(a)){var f=a;a=a.promise(),a._setDisposable(f)}s[o]=a}return t.settle(s).then(u).spread(i)._then(c,h,void 0,s,void 0)},t.prototype._setDisposable=function(t){this._bitField=this._bitField|262144,this._disposer=t},t.prototype._isDisposable=function(){return(this._bitField&262144)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=this._bitField&-262145,this._disposer=void 0},t.prototype.disposer=function(t){if(typeof t=="function")return new d(t,this);throw new i}}},{"./errors.js":10,"./util.js":35}],35:[function(require,module,exports){function tryCatch1(e,t,n){try{return e.call(t,n)}catch(r){return errorObj.e=r,errorObj}}function tryCatch2(e,t,n,r){try{return e.call(t,n,r)}catch(i){return errorObj.e=i,errorObj}}function tryCatch3(e,t,n,r,i){try{return e.call(t,n,r,i)}catch(s){return errorObj.e=s,errorObj}}function tryCatch4(e,t,n,r,i,s){try{return e.call(t,n,r,i,s)}catch(o){return errorObj.e=o,errorObj}}function tryCatchApply(e,t,n){try{return e.apply(n,t)}catch(r){return errorObj.e=r,errorObj}}function asString(e){return typeof e=="string"?e:""+e}function isPrimitive(e){return e==null||e===!0||e===!1||typeof e=="string"||typeof e=="number"}function isObject(e){return!isPrimitive(e)}function maybeWrapAsError(e){return isPrimitive(e)?new Error(asString(e)):e}function withAppended(e,t){var n=e.length,r=new Array(n+1),i;for(i=0;i<n;++i)r[i]=e[i];return r[i]=t,r}function getDataPropertyOrDefault(e,t,n){if(!es5.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);if(r!=null)return r.get==null&&r.set==null?r.value:n}function notEnumerableProp(e,t,n){if(isPrimitive(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(e,t,r),e}function thrower(e){throw e}function isClass(e){try{if(typeof e=="function"){var t=es5.keys(e.prototype);return t.length>0&&(t.length!==1||t[0]!=="constructor")}return!1}catch(n){return!1}}function toFastProperties(obj){function f(){}return f.prototype=obj,f}function isIdentifier(e){return rident.test(e)}function filledRange(e,t,n){var r=new Array(e);for(var i=0;i<e;++i)r[i]=t+i+n;return r}var es5=require("./es5.js"),haveGetters=function(){try{var e={};return es5.defineProperty(e,"f",{get:function(){return 3}}),e.f===3}catch(t){return!1}}(),canEvaluate=typeof navigator=="undefined",errorObj={e:{}},inherits=function(e,t){function r(){this.constructor=e,this.constructor$=t;for(var r in t.prototype)n.call(t.prototype,r)&&r.charAt(r.length-1)!=="$"&&(this[r+"$"]=t.prototype[r])}var n={}.hasOwnProperty;return r.prototype=t.prototype,e.prototype=new r,e.prototype},wrapsPrimitiveReceiver=function(){return this!=="string"}.call("string"),inheritedDataKeys=function(){return es5.isES5?function(e,t){var n=[],r=Object.create(null),i=Object(t).includeHidden?Object.getOwnPropertyNames:Object.keys;while(e!=null){var s;try{s=i(e)}catch(o){return n}for(var u=0;u<s.length;++u){var a=s[u];if(r[a])continue;r[a]=!0;var f=Object.getOwnPropertyDescriptor(e,a);f!=null&&f.get==null&&f.set==null&&n.push(a)}e=es5.getPrototypeOf(e)}return n}:function(e){var t=[];for(var n in e)t.push(n);return t}}(),rident=/^[a-z$_][a-z$_0-9]*$/i,ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch1:tryCatch1,tryCatch2:tryCatch2,tryCatch3:tryCatch3,tryCatch4:tryCatch4,tryCatchApply:tryCatchApply,inherits:inherits,withAppended:withAppended,asString:asString,maybeWrapAsError:maybeWrapAsError,wrapsPrimitiveReceiver:wrapsPrimitiveReceiver,toFastProperties:toFastProperties,filledRange:filledRange};module.exports=ret},{"./es5.js":12}]},{},[3])(3)}),typeof window!="undefined"&&window!==null?window.P=window.Promise:typeof self!="undefined"&&self!==null&&(self.P=self.Promise);