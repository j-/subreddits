(function(e,t){typeof define=="function"&&define.amd?define("ok.views",["ok"],e):typeof module!="undefined"&&typeof require=="function"?(t=require("ok"),e(t),module.exports=t):(t=window.okaylib,e(t))})(function(e){e.View=e.Base.extend({mergeProperties:["classNames"],classNames:["ok-view"],el:null,tagName:"div",id:null,isStarted:!1,childViews:null,constructor:function(t){t=t||{},t.tagName&&(this.tagName=t.tagName),t.classNames&&(this.classNames=e.mergeValues(this.classNames,t.classNames));if(t.el)this.setElement(t.el);else{this.createElement();if(t.id||this.id)this.el.id=t.id||this.id}t.watch&&(this.watch=t.watch),this.isStarted=!1,this.childViews=new e.Items,this.init(t)},setElement:function(e){this.el=e},createElement:function(){var e=document.createElement(this.tagName);_.forEach(this.classNames,function(t){e.classList.add(t)}),this.setElement(e)},empty:function(){while(this.el.childNodes.length)this.el.removeChild(this.el.firstChild)},render:function(){this.renderChildViews()},start:function(){this.stop(),this.isStarted=!0,this.startChildViews()},stop:function(){this.isStarted=!1,this.stopListening(),this.stopChildViews()},addChildView:function(e,t){return typeof e=="function"&&(e=new e(t)),this.childViews.push(e),this.isStarted&&e.start(),e},removeChildView:function(e){var t=this.childViews.indexOf(e);t>=0&&this.childViews.remove(t,1),this.isStarted&&e.stop()},renderChildViews:function(){this.childViews.invoke("render")},startChildViews:function(){this.childViews.invoke("start")},stopChildViews:function(){this.childViews.invoke("stop")}}),e.SimpleView=e.View.extend({constructor:function(){e.View.apply(this,arguments),this.render(),this.start()},render:function(){this.empty(),this.template&&(this.el.innerHTML=this.template(this.watch.get()))},start:function(){this.sup("start"),this.watch&&this.listenTo(this.watch,"change",this.render.bind(this))}}),e.CollectionView=e.View.extend({defaultConstructor:e.View,childOptions:null,started:!1,resort:!0,constructor:function(t){e.View.apply(this,arguments),this.children=[],t||(t={}),t.childOptions&&(this.childOptions=t.childOptions),t.defaultConstructor&&(this.defaultConstructor=t.defaultConstructor)},start:function(){this.sup("start"),this.listenTo(this.watch,"add",this.addItem.bind(this)),this.listenTo(this.watch,"remove",this.removeItem.bind(this)),this.listenTo(this.watch,"sort",this.sort.bind(this))},render:function(){this.empty(),this.watch.each(this.addItem,this)},sort:function(){this.render()},addItem:function(e,t){var n=this.getItemView(e),r=this.watch.items,i=_.find(this.children,function(e){return _.indexOf(r,e.item)-1===t});this.children.push({item:e,view:n}),this.addChildView(n),n.render(),i?this.el.insertBefore(n.el,i.view.el):this.el.appendChild(n.el)},removeItem:function(e){_.each(this.children,function(t,n){if(t&&t.item===e){var r=t.view,i=r.el;return i.parentNode.removeChild(i),this.children.splice(n,1),this.removeChildView(r),r.stop(),!1}},this)},getConstructor:function(){return this.defaultConstructor},getItemView:function(e){var t=this.getConstructor(e),n=_.extend({watch:e},this.getChildOptions()),r=new t(n);return r},getChildOptions:function(){return this.childOptions}})});