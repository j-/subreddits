define(["require","views/embedded/EmbeddedView","models/GfyItemModel","views/GfyItemView"],function(e){var t=e("views/embedded/EmbeddedView"),n=e("models/GfyItemModel"),r=e("views/GfyItemView"),i=t.extend({className:"embedded-content embedded-gfycat",init:function(){this.canFetch=!0,this.gfyView=null},render:function(){this.ensureContent(),this.gfyView&&this.gfyView.play()},ensureContent:function(){if(!this.canFetch)return;this.showLoading(),this.canFetch=!1;var e=this.watch.get("url"),t=i.getIdFromUrl(e),n="http://gfycat.com/cajax/get/"+t;$.ajax({url:n,context:this,dataType:"jsonp",success:function(e){this.processResponse(e)},error:function(e,t,n){this.showError(),this.canFetch=!0}})},processResponse:function(e){this.empty(),this.gfyView=this.addChildView(r,{watch:new n(e.gfyItem)}),this.gfyView.render(),this.el.appendChild(this.gfyView.el)},showLoading:function(){var e=$.create("span").addClass("text-muted").text("Loadingâ€¦");this.empty(),this.$el.append(e)},showError:function(){this.$el.text("There was an error loading this tweet")}});return i.gfycatExp=/^https?:\/\/(?:(?:www|zippy|fat|giant)\.)?gfycat\.com\/(\w+)(?:\.\w+)?/i,i.identify=function(e){var t=e.get("url");return i.gfycatExp.test(t)},i.getIdFromUrl=function(e){var t=e.match(i.gfycatExp),n=t[1];return n},i});