define(["require","ok","ok.dollarview","underscore","models/AccountModel","models/SubredditModel","views/LinkTitleView","views/InlineUserView","views/InlineSubredditView","views/TimeView","views/GoldView","modules/embedded","modules/pagerouter","text!templates/Link.html"],function(e){var t=e("ok");e("ok.dollarview");var n=e("underscore"),r=e("models/AccountModel"),i=e("models/SubredditModel"),s=e("views/LinkTitleView"),o=e("views/InlineUserView"),u=e("views/InlineSubredditView"),a=e("views/TimeView"),f=e("views/GoldView"),l=e("modules/embedded"),c=e("modules/pagerouter"),h=e("text!templates/Link.html"),p=t.$View.extend({className:"link",init:function(){n.bindAll(this,"handleClickThumbnail","handleClickComments","handleClickDomain"),this.author=new r({name:this.watch.get("author")}),this.subreddit=new i({display_name:this.watch.get("subreddit")}),this.inlineUserView=this.addChildView(o,{watch:this.author}),this.linkTitleView=this.addChildView(s,{watch:this.watch}),this.inlineSubredditView=this.addChildView(u,{watch:this.subreddit}),this.timeView=this.addChildView(a,{watch:this.watch.getProperty("created_utc")}),this.goldView=this.addChildView(f,{watch:this.watch.getProperty("gilded")}),this.embeddedView=null;var e=l.identify(this.watch);e&&(this.embeddedView=this.addChildView(e,{watch:this.watch}))},render:function(){this.empty(),this.$el.html(h).toggleClass("over18",this.watch.get("over_18")).toggleClass("stickied",this.watch.get("stickied")),this.renderThumbnail(),this.renderTitle(),this.renderDomain(),this.renderScore(),this.renderCreated(),this.renderAuthor(),this.renderComments(),this.renderSubreddit(),this.renderGold(),this.renderEmbeddedMedia()},renderThumbnail:function(){var e=this.watch.get("url"),t=this.watch.get("thumbnail"),n=this.$(".thumbnail").attr("href",e);t?n.css("background-image","url("+t+")").removeClass("empty"):n.css("background-image",null).addClass("empty")},renderTitle:function(){this.linkTitleView.setElement(this.$(".link-title")),this.linkTitleView.render()},renderDomain:function(){var e=this.watch.get("domain"),t="http://www.reddit.com/domain/"+e;this.$(".domain").text(e).attr("href",t)},renderScore:function(){var e=this.watch.get("score");e+=" "+(e===1?"point":"points"),this.$(".score").text(e)},renderCreated:function(){this.timeView.setElement(this.$(".time")),this.timeView.render()},renderAuthor:function(){var e=this.watch.get("distinguished");this.inlineUserView.render(),this.$(".author").empty().append(this.inlineUserView.el),e&&(e==="moderator"?this.inlineUserView.showModerator():e==="admin"?this.inlineUserView.showAdmin():e==="special"&&this.inlineUserView.showSpecial())},renderComments:function(){var e=this.watch.getCommentURL(),t=this.watch.get("num_comments");t+=" "+(t===1?"comment":"comments"),this.$(".comments").attr("href",e).attr("title","View comments").text(t)},renderSubreddit:function(){this.inlineSubredditView.render(),this.$(".subreddit").empty().append(this.inlineSubredditView.el)},renderGold:function(){this.goldView.setElement(this.$(".gold")),this.goldView.render()},renderEmbeddedMedia:function(){this.embeddedView&&(this.$el.addClass("has-embedded"),this.showingEmbedded&&this.showEmbedded())},toggleEmbedded:function(){if(this.embeddedView){var e=this.$("embedded"),t=this.showingEmbedded;t?this.hideEmbedded():this.showEmbedded()}},showEmbedded:function(){this.embeddedView&&(this.showingEmbedded=!0,this.embeddedView.render(),this.$(".embedded").show().append(this.embeddedView.$el),this.$el.addClass("showing-embedded"))},hideEmbedded:function(){this.embeddedView&&(this.showingEmbedded=!1,this.$(".embedded").hide().children().detach(),this.$el.removeClass("showing-embedded"))},handleClickThumbnail:function(e){e.ctrlKey||(e.preventDefault(),this.embeddedView&&this.toggleEmbedded())},handleClickComments:function(e){if(!e.ctrlKey){e.preventDefault();var t=this.watch.get("id");c.go("/comments/"+t)}},handleClickDomain:function(e){if(!e.ctrlKey){e.preventDefault();var t=this.watch.get("domain");c.go("/domain/"+t)}},start:function(){this.stop(),t.$View.prototype.start.call(this),this.$el.on("click",".thumbnail",this.handleClickThumbnail),this.$el.on("click",".comments",this.handleClickComments),this.$el.on("click",".domain",this.handleClickDomain)},stop:function(){t.$View.prototype.stop.call(this),this.$el.off("click",".thumbnail",this.handleClickThumbnail),this.$el.off("click",".comments",this.handleClickComments),this.$el.off("click",".domain",this.handleClickDomain)}});return p});