(function(e){e.View=e.Base.extend({el:null,tagName:"div",constructor:function(e){e=e||{},e.tagName&&(this.tagName=e.tagName),e.className&&(this.className=e.className);if(e.el)this.setElement(e.el);else{this.createElement();if(e.id||this.id)this.el.id=e.id||this.id}e.watch&&(this.watch=e.watch),this.isStarted=!1,this.childViews=[],this.init(e)},setElement:function(e){this.el=e},createElement:function(){var e=document.createElement(this.tagName);this.className&&(e.className=this.className),this.setElement(e)},empty:function(){while(this.el.children.length)this.el.removeChild(this.el.firstChild)},render:function(){this.renderChildViews()},start:function(){this.stop(),this.isStarted=!0,this.startChildViews()},stop:function(){this.isStarted=!1,this.stopListening(),this.stopChildViews()},addChildView:function(e,t){return typeof e=="function"&&(e=new e(t)),this.childViews.push(e),this.isStarted&&e.start(),e},removeChildView:function(e){var t=_.indexOf(this.childViews,e);t>=0&&this.childViews.splice(t,1)},renderChildViews:function(){_.invoke(this.childViews,"render")},startChildViews:function(){_.invoke(this.childViews,"start")},stopChildViews:function(){_.invoke(this.childViews,"stop")}}),e.SimpleView=e.View.extend({constructor:function(){e.View.apply(this,arguments),this.render(),this.start()},render:function(){this.empty(),this.template&&(this.innerHTML=this.template(this.watch.get()))},start:function(){e.View.fn.start.call(this),this.watch&&this.listenTo(this.watch,"change",this.render.bind(this))}}),e.CollectionView=e.View.extend({defaultConstructor:e.View,childOptions:null,started:!1,resort:!0,constructor:function(t){e.View.apply(this,arguments),this.children=[],t||(t={}),t.childOptions&&(this.childOptions=t.childOptions),t.defaultConstructor&&(this.defaultConstructor=t.defaultConstructor)},start:function(){e.View.fn.start.call(this),this.listenTo(this.watch,"add",this.addItem.bind(this)),this.listenTo(this.watch,"remove",this.removeItem.bind(this)),this.listenTo(this.watch,"sort",this.sort.bind(this))},render:function(){this.empty(),this.watch.each(this.addItem,this)},sort:function(){this.render()},addItem:function(e,t){var n=this.getItemView(e),r=this.watch.items,i=_.find(this.children,function(e){return _.indexOf(r,e.item)-1===t});this.children.push({item:e,view:n}),this.addChildView(n),n.render(),i?this.el.insertBefore(n.el,i.view.el):this.el.appendChild(n.el)},removeItem:function(e){_.each(this.children,function(t,n){if(t&&t.item===e){var r=t.view,i=r.el;return i.parentNode.removeChild(i),this.children.splice(n,1),this.removeChildView(r),r.stop(),!1}},this)},getConstructor:function(){return this.defaultConstructor},getItemView:function(e){var t=this.getConstructor(e),n=_.extend({watch:e},this.getChildOptions()),r=new t(n);return r},getChildOptions:function(){return this.childOptions}})})(okaylib);