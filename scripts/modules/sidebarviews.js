define(["require","exports","module","ok","ok.views","jquery","underscore","modules/pagerouter","models/SubredditModel","views/InlineSubredditView"],function(e,t){var n=e("ok");e("ok.views");var r=e("jquery"),i=e("underscore"),s=e("modules/pagerouter"),o=e("models/SubredditModel"),u=e("views/InlineSubredditView"),a=u.extend({render:function(){u.prototype.render.call(this),r(this.el).attr("tabindex",-1)}}),f=n.View.extend({tagName:"li",className:"subreddit",init:function(){this.subredditIdView=new a({watch:this.watch})},render:function(){this.empty(),this.subredditIdView.render();var e=r("<div/>").addClass("details").append(this.subredditIdView.el);r(this.el).append(e)},handleMousedownDetails:function(e){e.stopPropagation(),r(this.subredditIdView.el).focus()},start:function(){this.stop(),r(this.el).on("mousedown",".details",i.bind(this.handleMousedownDetails,this)),this.subredditIdView.start()},stop:function(){n.View.prototype.stop.call(this),r(this.el).off("mousedown",".details")}}),l=n.SimpleView.extend({tagName:"a",className:"multireddit-name",render:function(){var e=this.watch.get("name"),t=this.watch.toString();r(this.el).attr("tabindex",-1).attr("href","http://www.reddit.com/r/"+t).text(e)},handleClick:function(e){if(!e.ctrlKey){e.preventDefault();var t=this.watch.toString();s.go("/r/"+t)}},start:function(){n.SimpleView.prototype.start.call(this),r(this.el).on("click",i.bind(this.handleClick,this))},stop:function(){n.SimpleView.prototype.stop.call(this),r(this.el).off("click")}}),c=n.CollectionView.extend({tagName:"ul",className:"subreddits",defaultConstructor:f,getConstructor:function(e){return e instanceof o?f:h}}),h=n.View.extend({tagName:"li",className:"multireddit",init:function(){this.childrenView=new c({watch:this.watch.properties.children}),this.nameView=new l({watch:this.watch}),this.$collapse=r("<div/>").attr("tabindex",-1).addClass("collapse-toggle expanded")},render:function(){this.empty(),this.childrenView.render(),this.nameView.render();var e=r("<div/>").addClass("details").append(this.$collapse).append(this.nameView.el);r(this.el).append(e).append(this.childrenView.el)},toggleCollapse:function(e){e.preventDefault();var t=r(this.childrenView.el);t.toggle();var n=t.is(":visible");r(this.el).toggleClass("hide-children",!n),this.$collapse.toggleClass("expanded",n)},hideChildren:function(){var e=r(this.childrenView.el);e.hide(),r(this.el).addClass("hide-children"),this.$collapse.removeClass("expanded")},showChildren:function(){var e=r(this.childrenView.el);e.show(),r(this.el).removeClass("hide-children"),this.$collapse.addClass("expanded")},isChildrenShown:function(){return r(this.childrenView.el).is(":visible")},handleKeyDown:function(e){e.which===37?(e.preventDefault(),this.isChildrenShown()&&this.hideChildren()):e.which===39&&(e.preventDefault(),this.isChildrenShown()?r(this.childrenView.el).find("a").first().focus():this.showChildren())},handleMousedownDetails:function(e){e.stopPropagation(),r(this.nameView.el).focus()},start:function(){this.stop(),this.childrenView.start(),this.nameView.start(),this.$collapse.on("click",i.bind(this.toggleCollapse,this)),r(this.el).on("mousedown",".details",i.bind(this.handleMousedownDetails,this)),r(this.nameView.el).on("keydown",i.bind(this.handleKeyDown,this))},stop:function(){n.View.prototype.stop.apply(this,arguments),this.$collapse.off("click"),r(this.el).off("mousedown"),r(this.nameView.el).off("keydown")}});t.SubredditTextView=a,t.SubredditView=f,t.MultiredditTextView=l,t.MultiredditListView=c,t.MultiredditView=h});