/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */

(function(){var e=function(e){function i(e,t){if(e.indexOf)return e.indexOf(t);var n=e.length;while(n--)if(e[n]===t)return n;return-1}function s(e,t){var n=i(e,t);n!==-1&&e.splice(n,1)}function o(e,t){return"[object "+t+"]"===Object.prototype.toString.call(e)}function u(e){return o(e,"RegExp")}function a(e){return o(e,"Array")}function f(e){return typeof e=="function"}function l(e){var t;return e===null||e==="null"?t=null:e==="true"?t=!0:e==="false"?t=!1:e===r||e==="undefined"?t=r:e===""||isNaN(e)?t=e:t=parseFloat(e),t}function c(e){var t=e.length,n=[];while(t--)n[t]=l(e[t]);return n}function h(e,t){var n=(e||"").replace("?","").split("&"),r=n.length,i={},s,o;while(r--)s=n[r].split("="),o=t?l(s[1]):s[1],i[s[0]]=typeof o=="string"?decodeURIComponent(o):o;return i}function p(){this.bypassed=new e.Signal,this.routed=new e.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function d(t,n,r,i){var s=u(t),o=i.patternLexer;this._router=i,this._pattern=t,this._paramsIds=s?null:o.getParamIds(t),this._optionalParamsIds=s?null:o.getOptionalParamsIds(t),this._matchRegexp=s?t:o.compilePattern(t,i.ignoreCase),this.matched=new e.Signal,this.switched=new e.Signal,n&&this.matched.add(n),this._priority=r||0}var t,n,r;return n=/t(.+)?/.exec("t")[1]==="",p.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new p},addRoute:function(e,t,n){var r=new d(e,t,n,this);return this._sortedInsert(r),r},removeRoute:function(e){s(this._routes,e),e._destroy()},removeAllRoutes:function(){var e=this.getNumRoutes();while(e--)this._routes[e]._destroy();this._routes.length=0},parse:function(e,t){e=e||"",t=t||[];if(!this.ignoreState&&(e===this._prevMatchedRequest||e===this._prevBypassedRequest))return;var n=this._getMatchedRoutes(e),r=0,i=n.length,s;if(i){this._prevMatchedRequest=e,this._notifyPrevRoutes(n,e),this._prevRoutes=n;while(r<i)s=n[r],s.route.matched.dispatch.apply(s.route.matched,t.concat(s.params)),s.isFirst=!r,this.routed.dispatch.apply(this.routed,t.concat([e,s])),r+=1}else this._prevBypassedRequest=e,this.bypassed.dispatch.apply(this.bypassed,t.concat([e]));this._pipeParse(e,t)},_notifyPrevRoutes:function(e,t){var n=0,r;while(r=this._prevRoutes[n++])r.route.switched&&this._didSwitch(r.route,e)&&r.route.switched.dispatch(t)},_didSwitch:function(e,t){var n,r=0;while(n=t[r++])if(n.route===e)return!1;return!0},_pipeParse:function(e,t){var n=0,r;while(r=this._piped[n++])r.parse(e,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(e){var t=this._routes,n=t.length;do--n;while(t[n]&&e._priority<=t[n]._priority);t.splice(n+1,0,e)},_getMatchedRoutes:function(e){var t=[],n=this._routes,r=n.length,i;while(i=n[--r]){(!t.length||this.greedy||i.greedy)&&i.match(e)&&t.push({route:i,params:i._getParamsArray(e)});if(!this.greedyEnabled&&t.length)break}return t},pipe:function(e){this._piped.push(e)},unpipe:function(e){s(this._piped,e)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},t=new p,t.VERSION="0.12.0",t.NORM_AS_ARRAY=function(e,t){return[t.vals_]},t.NORM_AS_OBJECT=function(e,t){return[t]},d.prototype={greedy:!1,rules:void 0,match:function(e){return e=e||"",this._matchRegexp.test(e)&&this._validateParams(e)},_validateParams:function(e){var t=this.rules,n=this._getParamsObject(e),r;for(r in t)if(r!=="normalize_"&&t.hasOwnProperty(r)&&!this._isValidParam(e,r,n))return!1;return!0},_isValidParam:function(e,t,n){var r=this.rules[t],s=n[t],o=!1,l=t.indexOf("?")===0;return s==null&&this._optionalParamsIds&&i(this._optionalParamsIds,t)!==-1?o=!0:u(r)?(l&&(s=n[t+"_"]),o=r.test(s)):a(r)?(l&&(s=n[t+"_"]),o=this._isValidArrayRule(r,s)):f(r)&&(o=r(s,e,n)),o},_isValidArrayRule:function(e,t){if(!this._router.ignoreCase)return i(e,t)!==-1;typeof t=="string"&&(t=t.toLowerCase());var n=e.length,r,s;while(n--){r=e[n],s=typeof r=="string"?r.toLowerCase():r;if(s===t)return!0}return!1},_getParamsObject:function(e){var t=this._router.shouldTypecast,r=this._router.patternLexer.getParamValues(e,this._matchRegexp,t),s={},o=r.length,u,a;while(o--)a=r[o],this._paramsIds&&(u=this._paramsIds[o],u.indexOf("?")===0&&a&&(s[u+"_"]=a,a=h(a,t),r[o]=a),n&&a===""&&i(this._optionalParamsIds,u)!==-1&&(a=void 0,r[o]=a),s[u]=a),s[o]=a;return s.request_=t?l(e):e,s.vals_=r,s},_getParamsArray:function(e){var t=this.rules?this.rules.normalize_:null,n;return t=t||this._router.normalizeFn,t&&f(t)?n=t(e,this._getParamsObject(e)):n=this._getParamsObject(e).vals_,n},interpolate:function(e){var t=this._router.patternLexer.interpolate(this._pattern,e);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},p.prototype.patternLexer=function(){function f(){var e,t;for(e in i)i.hasOwnProperty(e)&&(t=i[e],t.id="__CR_"+e+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function l(e,t){var n=[],r;e.lastIndex=0;while(r=e.exec(t))n.push(r[1]);return n}function h(e){return l(r,e)}function p(e){return l(i.OP.rgx,e)}function d(r,i){return r=r||"",r&&(a===s?r=r.replace(t,""):a===u&&(r=r.replace(n,"")),r=v(r,"rgx","save"),r=r.replace(e,"\\$&"),r=v(r,"rRestore","res"),a===s&&(r="\\/?"+r)),a!==o&&(r+="\\/?"),new RegExp("^"+r+"$",i?"i":"")}function v(e,t,n){var r,s;for(s in i)i.hasOwnProperty(s)&&(r=i[s],e=e.replace(r[t],r[n]));return e}function m(e,t,n){var r=t.exec(e);return r&&(r.shift(),n&&(r=c(r))),r}function g(e,t){if(typeof e!="string")throw new Error("Route pattern should be a string.");var n=function(e,n){var r;n=n.substr(0,1)==="?"?n.substr(1):n;if(t[n]!=null){if(typeof t[n]=="object"){var i=[];for(var s in t[n])i.push(encodeURI(s+"="+t[n][s]));r="?"+i.join("&")}else r=String(t[n]);if(e.indexOf("*")===-1&&r.indexOf("/")!==-1)throw new Error('Invalid value "'+r+'" for segment "'+e+'".')}else{if(e.indexOf("{")!==-1)throw new Error("The segment "+e+" is required.");r=""}return r};return i.OS.trail||(i.OS.trail=new RegExp("(?:"+i.OS.id+")+$")),e.replace(i.OS.rgx,i.OS.save).replace(r,n).replace(i.OS.trail,"").replace(i.OS.rRestore,"/")}var e=/[\\.+*?\^$\[\](){}\/'#]/g,t=/^\/|\/$/g,n=/\/$/g,r=/(?:\{|:)([^}:]+)(?:\}|:)/g,i={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},s=1,o=2,u=3,a=s;return f(),{strict:function(){a=o},loose:function(){a=s},legacy:function(){a=u},getParamIds:h,getOptionalParamsIds:p,getParamValues:m,compilePattern:d,interpolate:g}}(),t};typeof define=="function"&&define.amd?define(["signals"],e):typeof module!="undefined"&&module.exports?module.exports=e(require("signals")):window.crossroads=e(window.signals)})();